<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>8.7.2.0 | Recipes | SSL/TLS Client Authentication</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="/_stylesheets/asciibinder.css" >
  <link rel="stylesheet" href="/_stylesheets/repose.css" >

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body onload="selectVersion('8.7.2.0');">
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a class="navbar-brand" href="http://www.openrepose.org/">
          <img alt="OpenRepose" src="/_images/repose-logo.png" align="bottom">
        </a>
      </li>
      <li class="sitename">
        <a href="../../index.html">
          Home
        </a>
      </li>
      <li class="hidden-xs active">
        <a href="/versions/8.7.2.0/welcome/index.html">
          Repose
        </a>
        <select id="version-selector" onchange="versionSelector(this);" w3-include-html="/_includes/versions.html">
        </select>
      </li>
      <li class="hidden-xs active">
        <a href="../recipes/index.html">Recipes</a>
      </li>
      
      <li class="hidden-xs active">
        SSL/TLS Client Authentication
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <a class="navbar-search" href="/versions/search.html">
          <span class="glyphicon glyphicon-search"/>
          Search
        </a>
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>Welcome to Repose
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../welcome/index.html">Welcome</a></li>
            <li><a class="" href="../welcome/troubleshooting.html">Troubleshooting</a></li>
            <li><a class="" href="../welcome/release-notes.html">Release Notes</a></li>
            <li><a class="" href="../welcome/style-guide.html">Style Guide</a></li>
            <li><a class="" href="../welcome/faq.html">FAQ</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>Architecture
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../architecture/index.html">Overview</a></li>
            <li><a class="" href="../architecture/configuration.html">Configuration</a></li>
            <li><a class="" href="../architecture/container.html">Container</a></li>
            <li><a class="" href="../architecture/packages.html">Packages</a></li>
            <li><a class="" href="../architecture/system-model.html">System Model</a></li>
            <li><a class="" href="../architecture/performance.html">Performance</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-down"></span>Recipes
      </a>
      <ul id="topicGroup2" class="collapse in list-unstyled">
            <li><a class="" href="../recipes/index.html">Overview</a></li>
            <li><a class="" href="../recipes/quick-start.html">Quick Start</a></li>
            <li><a class="" href="../recipes/getting-started.html">Getting Started</a></li>
            <li><a class="" href="../recipes/custom-filter-for-repose.html">Custom Filter for Repose</a></li>
            <li><a class="" href="../recipes/docker.html">Docker</a></li>
            <li><a class="" href="../recipes/performance-best-practices.html">Performance Best Practices</a></li>
            <li><a class="" href="../recipes/role-based-access-control.html">Role Based Access Control</a></li>
            <li><a class="" href="../recipes/running-valve.html">Running Valve</a></li>
            <li><a class="" href="../recipes/valve-installation.html">Valve Installation</a></li>
            <li><a class="" href="../recipes/war-installation.html">WAR Installation</a></li>
            <li><a class="" href="../recipes/echo-server.html">Echo Server</a></li>
            <li><a class="" href="../recipes/rate-limiting.html">Rate Limiting</a></li>
            <li><a class="" href="../recipes/user-access-events.html">User Access Events</a></li>
            <li><a class="" href="../recipes/basic-authentication.html">Basic Authentication</a></li>
            <li><a class="" href="../recipes/delegation.html">Delegation</a></li>
            <li><a class="" href="../recipes/preventing-xml-bomb.html">Preventing XML bomb attacks</a></li>
            <li><a class="" href="../recipes/api-event-flume.html">API Access Event Recording with Flume</a></li>
            <li><a class="" href="../recipes/xsd-versioning.html">XSD Versioning Guidelines</a></li>
            <li><a class=" active" href="../recipes/client-authentication.html">SSL/TLS Client Authentication</a></li>
            <li><a class="" href="../recipes/functional-test-framework.html">Functional Test Framework</a></li>
            <li><a class="" href="../recipes/glassfish-setup.html">Glassfish Setup</a></li>
            <li><a class="" href="../recipes/tomcat-setup.html">Tomcat Setup</a></li>
            <li><a class="" href="../recipes/http-container-attributes.html">HTTP Container Attributes</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-right"></span>Filters
      </a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../filters/index.html">Overview</a></li>
            <li><a class="" href="../filters/add-header.html">Add Header Filter</a></li>
            <li><a class="" href="../filters/api-validator.html">API Validator Filter</a></li>
            <li><a class="" href="../filters/attribute-mapping-policy-validation.html">Attribute Mapping Policy Validation filter</a></li>
            <li><a class="" href="../filters/body-extractor-to-header.html">Body Extractor to Header Filter</a></li>
            <li><a class="" href="../filters/body-patcher.html">Body Patcher Filter</a></li>
            <li><a class="" href="../filters/compression.html">Compression Filter</a></li>
            <li><a class="" href="../filters/content-type-stripper.html">Content Type Stripper Filter</a></li>
            <li><a class="" href="../filters/cors.html">CORS Filter</a></li>
            <li><a class="" href="../filters/derp.html">Delegation Response Processor (DeRP) Filter</a></li>
            <li><a class="" href="../filters/destination-router.html">Destination Router Filter</a></li>
            <li><a class="" href="../filters/echo.html">Echo Filter</a></li>
            <li><a class="" href="../filters/exception.html">Exception Filter</a></li>
            <li><a class="" href="../filters/forwarded-proto.html">Forwarded Protocol Filter</a></li>
            <li><a class="" href="../filters/header-normalization.html">Header Normalization filter</a></li>
            <li><a class="" href="../filters/header-translation.html">Header Translation Filter</a></li>
            <li><a class="" href="../filters/header-user.html">Header User Filter</a></li>
            <li><a class="" href="../filters/herp.html">Highly Efficient Record Processor (HERP) Filter</a></li>
            <li><a class="" href="../filters/ip-user.html">IP User Filter</a></li>
            <li><a class="" href="../filters/iri-validator.html">IRI Validator Filter</a></li>
            <li><a class="" href="../filters/keystone-v2.html">Keystone v2 Filter</a></li>
            <li><a class="" href="../filters/keystone-v2-basic-auth.html">Keystone v2 Basic Auth Filter</a></li>
            <li><a class="" href="../filters/merge-header.html">Merge Header Filter</a></li>
            <li><a class="" href="../filters/openstack-identity-v3.html">Openstack Identity v3 Filter</a></li>
            <li><a class="" href="../filters/rackspace-auth-user.html">Rackspace Auth User Filter</a></li>
            <li><a class="" href="../filters/rate-limiting.html">Rate Limiting Filter</a></li>
            <li><a class="" href="../filters/saml-policy.html">SAML Policy Translation Filter</a></li>
            <li><a class="" href="../filters/scripting.html">Scripting Filter</a></li>
            <li><a class="" href="../filters/simple-rbac.html">Simple Role Based Access Control (RBAC) Filter</a></li>
            <li><a class="" href="../filters/slf4j-http-logging.html">SFL4J HTTP Logging Filter</a></li>
            <li><a class="" href="../filters/tenant-culling.html">Tenant Culling Filter</a></li>
            <li><a class="" href="../filters/translation.html">Translation Filter</a></li>
            <li><a class="" href="../filters/uri-normalization.html">URI Normalization Filter</a></li>
            <li><a class="" href="../filters/uri-stripper.html">URI Stripper Filter</a></li>
            <li><a class="" href="../filters/uri-user.html">URI User Filter</a></li>
            <li><a class="" href="../filters/url-extractor-to-header.html">URL Extractor to Header Filter</a></li>
            <li><a class="" href="../filters/valkyrie-authorization.html">Valkyrie Authorization Filter</a></li>
            <li><a class="" href="../filters/versioning.html">Versioning Filter</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-right"></span>Services
      </a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../services/index.html">Overview</a></li>
            <li><a class="" href="../services/atom-feed-consumption.html">Atom Feed Consumption Service</a></li>
            <li><a class="" href="../services/datastores.html">Datastores</a></li>
            <li><a class="" href="../services/health-check.html">Health Check service</a></li>
            <li><a class="" href="../services/http-connection-pool.html">HTTP Connection Pool service</a></li>
            <li><a class="" href="../services/metrics.html">Metrics Service</a></li>
            <li><a class="" href="../services/phone-home.html">Phone Home Service</a></li>
            <li><a class="" href="../services/response-messaging.html">Response Messaging service</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup5">
        <span id="tgSpan5" class="fa fa-angle-right"></span>Developer
      </a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li><a class="" href="../developer/index.html">Overview</a></li>
            <li><a class="" href="../developer/docker.html">Docker</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>SSL/TLS Client Authentication</h2>
        </div>
        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This recipe explains how to utilize SSL/TLS Client Authentication in <strong>Repose</strong>.</p>
</div>
<div class="paragraph">
<p>SSL/TLS provides an encrypted link between the client and the server, and is the standard for sending private data over the internet.
You may want to enable SSL/TLS Client Authentication if part of your infrastructure is in a different datacenter to ensure only cross service traffic can reach your service.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="background"><a class="anchor" href="#background"></a>Background</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SSL/TLS Client Authentication is being used more and more for communications between different enclaves.
This addition to the server based SSL/TLS handshake involves the Client presenting credentials to the Server in the same manner as the Server does to the Client.
If the credentials presented by the Client are not trusted, then the Server will sever the connection just as the Client would have if the situation was reversed.
Since a Client initiates contact with the Server, the Server&#8217;s credentials are simply to validate it is who the Client was trying to contact.
This is accomplished through Certificate Authorities (CA) and the Trust Hierarchies built into the Public Key Infrastructure (PKI).
Even though you can optionally add a particular Server&#8217;s credentials directly into a Client so that it will implicitly trust a particular Server essentially bypassing the distributed trust mechanism in favor of a more direct one, this is the only way to build a relationship for a Client to a Server.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generate-and-install-the-certificate"><a class="anchor" href="#generate-and-install-the-certificate"></a>Generate and Install the Certificate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the following steps, the <em>client</em> will refer to the entity sending the request, and the <em>server</em> will refer to the entity receiving the request.
If you are setting up client authentication for requests inbound to <strong>Repose</strong>, then the entity sending the request is the <em>client</em> and <strong>Repose</strong> is the <em>server</em>.
If you are setting up client authentication for requests outbound from <strong>Repose</strong> to the origin service, then <strong>Repose</strong> is the <em>client</em> and the origin service is the <em>server</em>.</p>
</div>
<div class="sect2">
<h3 id="create-client-certificate"><a class="anchor" href="#create-client-certificate"></a>Generate the <em>client</em> key and certificate</h3>
<div class="paragraph">
<p>Using the JDK provided <code>keytool</code> generate the certificate that the <em>client</em> will use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -genkeypair -keystore client.jks -storepass password -keypass password -alias client -keyalg RSA -keysize 2048 -validity 36500 -sigalg SHA256withRSA</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="export-the-client-certificate"><a class="anchor" href="#export-the-client-certificate"></a>Export the <em>client</em> certificate</h3>
<div class="paragraph">
<p>Again, using the <code>keytool</code> export the certificate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -exportcert -keystore client.jks -storepass password -keypass password -alias client -file client.cer</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="import-into-server-keystore"><a class="anchor" href="#import-into-server-keystore"></a>Import the <em>client</em> certificate into the <em>server</em> keystore</h3>
<div class="paragraph">
<p>Using the <code>keytool</code> import <em>client</em> certificate into the <em>server</em> keystore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -importcert -keystore server.jks -storepass password -keypass password -alias client -file client.cer</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="client-to-repose-authentication"><a class="anchor" href="#client-to-repose-authentication"></a>Client to Repose Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With your certificates in the right spot it&#8217;s time to turn authentication on for <strong>Valve</strong>.
This is achieved with a simple tweak to the <code>container.cfg.xml</code>.</p>
</div>
<div class="listingblock">
<div class="title">Partial container.cfg.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;deployment-config&gt;</span>
    ...
    <span style="color:#070;font-weight:bold">&lt;ssl-configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;keystore-filename&gt;</span>server.jks<span style="color:#070;font-weight:bold">&lt;/keystore-filename&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span style="color:#070;font-weight:bold">&lt;keystore-password&gt;</span>password<span style="color:#070;font-weight:bold">&lt;/keystore-password&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span style="color:#070;font-weight:bold">&lt;key-password&gt;</span>password<span style="color:#070;font-weight:bold">&lt;/key-password&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span style="color:#070;font-weight:bold">&lt;/ssl-configuration&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/deployment-config&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The path and filename of the <em>server</em> keystore that you imported the certificate into <a href="#import-into-server-keystore">above</a>.
This path is based off of the <strong>Repose</strong> configuration directory, but absolute pathing is supported.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The password for the keystore that you imported the certificate into.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The password you used for the key/certificate itself when importing it into the keystore.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using the <strong>WAR</strong> deployment and not <strong>Valve</strong>, you will have to consult the documentation for your container to determine how to turn on client authentication.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repose-to-origin-service"><a class="anchor" href="#repose-to-origin-service"></a><strong>Repose</strong> to Origin Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To turn on authenticated communication to your origin service, you&#8217;ll need to tweak the default pool in your <a href="../services/http-connection-pool.html">HTTP Connection Pool service</a> config.
There is nothing stopping you from similarly tweaking any of your other pools if you have a need to use client authentication in other outbound communication.</p>
</div>
<div class="listingblock">
<div class="title">Partial http-connection-pool.cfg.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;pool</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">default</span><span style="color:#710">&quot;</span></span>
      <span style="color:#b48">default</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">true</span><span style="color:#710">&quot;</span></span>
      <span style="color:#b48">...</span>
      <span style="color:#b48">keystore-filename</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">client.jks</span><span style="color:#710">&quot;</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span style="color:#b48">keystore-password</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">password</span><span style="color:#710">&quot;</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
      <span style="color:#b48">key-password</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">password</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The path and filename of the <em>client</em> keystore that you created <a href="#create-client-certificate">above</a>.
This path is based off of the <strong>Repose</strong> configuration directory, but absolute pathing is supported.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The password for the keystore that you created.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The password for the key/certificate you created.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="further-information"><a class="anchor" href="#further-information"></a>Further Information</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>If one side of the communication is not JVM based you may need your certificate in a different format.</p>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html">keytool</a> page may offer some assistance, as well as going into depth on the many options available for the commands used above.</p>
</li>
<li>
<p>The <strong>Jetty</strong> <a href="http://www.eclipse.org/jetty/documentation/current/configuring-ssl.html">documentation</a> offers some assistance in using <strong>OpenSSL</strong> when alternative formats are needed as well.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For more information on what options are available when setting up <strong>Valve</strong> look <a href="../architecture/container.html">here</a>.</p>
</li>
<li>
<p>For more information about the http client connection pool look <a href="../services/http-connection-pool.html">here</a>.</p>
</li>
</ul>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="/_javascripts/page-loader.js" type="text/javascript"></script>
  <script src="/_javascripts/include-html.js" type="text/javascript"></script>
  <script>includeHTML();</script>
  <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>