<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>8.8.2.0 | Filters | Keystone v2 Authorization Filter</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="/_stylesheets/asciibinder.css" >
  <link rel="stylesheet" href="/_stylesheets/repose.css" >

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body onload="selectVersion('8.8.2.0');">
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a class="navbar-brand" href="http://www.openrepose.org/">
          <img alt="OpenRepose" src="/_images/repose-logo.png" align="bottom">
        </a>
      </li>
      <li class="sitename">
        <a href="../../index.html">
          Home
        </a>
      </li>
      <li class="hidden-xs active">
        <a href="/versions/8.8.2.0/welcome/index.html">
          Repose
        </a>
        <select id="version-selector" onchange="versionSelector(this);" w3-include-html="/_includes/versions.html">
        </select>
      </li>
      <li class="hidden-xs active">
        <a href="../filters/index.html">Filters</a>
      </li>
      
      <li class="hidden-xs active">
        Keystone v2 Authorization Filter
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <a class="navbar-search" href="/versions/search.html">
          <span class="glyphicon glyphicon-search"/>
          Search
        </a>
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>Welcome to Repose
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../welcome/index.html">Welcome</a></li>
            <li><a class="" href="../welcome/troubleshooting.html">Troubleshooting</a></li>
            <li><a class="" href="../welcome/release-notes.html">Release Notes</a></li>
            <li><a class="" href="../welcome/style-guide.html">Style Guide</a></li>
            <li><a class="" href="../welcome/faq.html">FAQ</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>Architecture
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../architecture/index.html">Overview</a></li>
            <li><a class="" href="../architecture/configuration.html">Configuration</a></li>
            <li><a class="" href="../architecture/container.html">Container</a></li>
            <li><a class="" href="../architecture/packages.html">Packages</a></li>
            <li><a class="" href="../architecture/system-model.html">System Model</a></li>
            <li><a class="" href="../architecture/performance.html">Performance</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-right"></span>Recipes
      </a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li><a class="" href="../recipes/index.html">Overview</a></li>
            <li><a class="" href="../recipes/quick-start.html">Quick Start</a></li>
            <li><a class="" href="../recipes/getting-started.html">Getting Started</a></li>
            <li><a class="" href="../recipes/custom-filter-for-repose.html">Custom Filter for Repose</a></li>
            <li><a class="" href="../recipes/docker.html">Docker</a></li>
            <li><a class="" href="../recipes/performance-best-practices.html">Performance Best Practices</a></li>
            <li><a class="" href="../recipes/role-based-access-control.html">Role Based Access Control</a></li>
            <li><a class="" href="../recipes/running-valve.html">Running Valve</a></li>
            <li><a class="" href="../recipes/valve-installation.html">Valve Installation</a></li>
            <li><a class="" href="../recipes/war-installation.html">WAR Installation</a></li>
            <li><a class="" href="../recipes/echo-server.html">Echo Server</a></li>
            <li><a class="" href="../recipes/rate-limiting.html">Rate Limiting</a></li>
            <li><a class="" href="../recipes/user-access-events.html">User Access Events</a></li>
            <li><a class="" href="../recipes/basic-authentication.html">Basic Authentication</a></li>
            <li><a class="" href="../recipes/delegation.html">Delegation</a></li>
            <li><a class="" href="../recipes/preventing-xml-bomb.html">Preventing XML bomb attacks</a></li>
            <li><a class="" href="../recipes/api-event-flume.html">API Access Event Recording with Flume</a></li>
            <li><a class="" href="../recipes/xsd-versioning.html">XSD Versioning Guidelines</a></li>
            <li><a class="" href="../recipes/client-authentication.html">SSL/TLS Client Authentication</a></li>
            <li><a class="" href="../recipes/functional-test-framework.html">Functional Test Framework</a></li>
            <li><a class="" href="../recipes/glassfish-setup.html">Glassfish Setup</a></li>
            <li><a class="" href="../recipes/tomcat-setup.html">Tomcat Setup</a></li>
            <li><a class="" href="../recipes/http-container-attributes.html">HTTP Container Attributes</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-down"></span>Filters
      </a>
      <ul id="topicGroup3" class="collapse in list-unstyled">
            <li><a class="" href="../filters/index.html">Overview</a></li>
            <li><a class="" href="../filters/add-header.html">Add Header Filter</a></li>
            <li><a class="" href="../filters/api-validator.html">API Validator Filter</a></li>
            <li><a class="" href="../filters/attribute-mapping-policy-validation.html">Attribute Mapping Policy Validation filter</a></li>
            <li><a class="" href="../filters/body-extractor-to-header.html">Body Extractor to Header Filter</a></li>
            <li><a class="" href="../filters/body-patcher.html">Body Patcher Filter</a></li>
            <li><a class="" href="../filters/compression.html">Compression Filter</a></li>
            <li><a class="" href="../filters/content-type-stripper.html">Content Type Stripper Filter</a></li>
            <li><a class="" href="../filters/cors.html">CORS Filter</a></li>
            <li><a class="" href="../filters/derp.html">Delegation Response Processor (DeRP) Filter</a></li>
            <li><a class="" href="../filters/destination-router.html">Destination Router Filter</a></li>
            <li><a class="" href="../filters/echo.html">Echo Filter</a></li>
            <li><a class="" href="../filters/exception.html">Exception Filter</a></li>
            <li><a class="" href="../filters/forwarded-proto.html">Forwarded Protocol Filter</a></li>
            <li><a class="" href="../filters/header-normalization.html">Header Normalization filter</a></li>
            <li><a class="" href="../filters/header-translation.html">Header Translation Filter</a></li>
            <li><a class="" href="../filters/header-user.html">Header User Filter</a></li>
            <li><a class="" href="../filters/herp.html">Highly Efficient Record Processor (HERP) Filter</a></li>
            <li><a class="" href="../filters/ip-user.html">IP User Filter</a></li>
            <li><a class="" href="../filters/iri-validator.html">IRI Validator Filter</a></li>
            <li><a class="" href="../filters/keystone-v2.html">Keystone v2 Filter</a></li>
            <li><a class=" active" href="../filters/keystone-v2-authorization.html">Keystone v2 Authorization Filter</a></li>
            <li><a class="" href="../filters/keystone-v2-basic-auth.html">Keystone v2 Basic Auth Filter</a></li>
            <li><a class="" href="../filters/merge-header.html">Merge Header Filter</a></li>
            <li><a class="" href="../filters/openstack-identity-v3.html">Openstack Identity v3 Filter</a></li>
            <li><a class="" href="../filters/rackspace-auth-user.html">Rackspace Auth User Filter</a></li>
            <li><a class="" href="../filters/rate-limiting.html">Rate Limiting Filter</a></li>
            <li><a class="" href="../filters/regex-rbac.html">RegEx Role Based Access Control (RBAC) Filter</a></li>
            <li><a class="" href="../filters/saml-policy.html">SAML Policy Translation Filter</a></li>
            <li><a class="" href="../filters/scripting.html">Scripting Filter</a></li>
            <li><a class="" href="../filters/simple-rbac.html">Simple Role Based Access Control (RBAC) Filter</a></li>
            <li><a class="" href="../filters/slf4j-http-logging.html">SFL4J HTTP Logging Filter</a></li>
            <li><a class="" href="../filters/tenant-culling.html">Tenant Culling Filter</a></li>
            <li><a class="" href="../filters/translation.html">Translation Filter</a></li>
            <li><a class="" href="../filters/uri-normalization.html">URI Normalization Filter</a></li>
            <li><a class="" href="../filters/uri-stripper.html">URI Stripper Filter</a></li>
            <li><a class="" href="../filters/uri-user.html">URI User Filter</a></li>
            <li><a class="" href="../filters/url-extractor-to-header.html">URL Extractor to Header Filter</a></li>
            <li><a class="" href="../filters/valkyrie-authorization.html">Valkyrie Authorization Filter</a></li>
            <li><a class="" href="../filters/versioning.html">Versioning Filter</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-right"></span>Services
      </a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../services/index.html">Overview</a></li>
            <li><a class="" href="../services/atom-feed-consumption.html">Atom Feed Consumption Service</a></li>
            <li><a class="" href="../services/datastores.html">Datastores</a></li>
            <li><a class="" href="../services/health-check.html">Health Check service</a></li>
            <li><a class="" href="../services/http-connection-pool.html">HTTP Connection Pool service</a></li>
            <li><a class="" href="../services/metrics.html">Metrics Service</a></li>
            <li><a class="" href="../services/phone-home.html">Phone Home Service</a></li>
            <li><a class="" href="../services/response-messaging.html">Response Messaging service</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup5">
        <span id="tgSpan5" class="fa fa-angle-right"></span>Developer
      </a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li><a class="" href="../developer/index.html">Overview</a></li>
            <li><a class="" href="../developer/docker.html">Docker</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Keystone v2 Authorization Filter</h2>
        </div>
        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The Keystone v2 Authorization Filter authorizes requests based on data about the user making the request.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="general-filter-information"><a class="anchor" href="#general-filter-information"></a>General filter information</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Name:</strong> keystone-v2-authorization</p>
</li>
<li>
<p><strong>Default Configuration:</strong> keystone-v2-authorization.cfg.xml</p>
</li>
<li>
<p><strong>Released:</strong> v8.8.0.0</p>
</li>
<li>
<p><strong>Bundle:</strong> repose-filter-bundle</p>
</li>
<li>
<p><a href="../schemas/keystone-v2-authorization.xsd">Schema</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites-postconditions"><a class="anchor" href="#prerequisites-postconditions"></a>Prerequisites &amp; Postconditions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="required-request-headers"><a class="anchor" href="#required-request-headers"></a>Required Request Headers</h3>
<div class="paragraph">
<p>The following headers are expected to be populated by the <a href="keystone-v2.html">Keystone v2 Filter</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>X-Map-Roles</code></p>
</li>
<li>
<p><code>X-Catalog</code> (Only required for endpoint authorization)</p>
</li>
<li>
<p><code>X-Tenant-Id</code> (Configurable, and only required for tenant authorization if configured to extract the tenant from a header)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="required-preceding-filters"><a class="anchor" href="#required-preceding-filters"></a>Required Preceding Filters</h3>
<div class="paragraph">
<p>This filter expects that the <a href="keystone-v2.html">Keystone v2 Filter</a> precede it to populate necessary user data.
Be aware, however, that the necessary user data is transported via request header, and thus, could could be populated elsewhere.</p>
</div>
<div class="paragraph">
<p>It is best practice to prevent spoofing by putting the <a href="header-normalization.html">Header Normalization filter</a> before any authentication and/or authorization filters so that it can remove any headers that would be populated by them.</p>
</div>
</div>
<div class="sect2">
<h3 id="request-headers-created"><a class="anchor" href="#request-headers-created"></a>Request Headers Created</h3>
<div class="paragraph">
<p>The following headers are created:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>X-Tenant-Id</code> - The Tenant ID&#8217;s for the user.
This header will only be added if this filter is configured to validate tenants.
If this header already exists, this filter will either add the matching tenant to the header value or replace the header value with just the matching tenant depending on how this filter is configured.</p>
</li>
<li>
<p><code>X-Roles</code> - Identifies roles (e.g., <code>admin</code>, <code>user</code>).
This header will be always be added with a value of all of the user&#8217;s roles associated with the validated tenant.
If no tenant has been validated, then all user roles will be added to this header.
If this header already exists, it will be replaced.</p>
</li>
<li>
<p><code>X-Map-Roles</code> - The tenant-to-roles mapping for the user&#8217;s tenants which are validated and roles associated with those tenants.
This header will not be modified if the <code>send-all-tenant-ids</code> configuration attribute is set to <code>true</code>.
This header is a base 64 encoded JSON map of strings to arrays of strings (e.g., the base 64 encoding of <code>{"someTenant": ["someRole", "sharedRole"], "otherTenant": ["otherRole", "sharedRole"]}</code>).
Roles without a tenant association will be mapped to the <code>repose/domain/roles</code> key (e.g., <code>{"repose/domain/roles": ["tenantlessRole"]}</code>).</p>
</li>
<li>
<p><code>X-Identity-Status</code> - Indicates if identity has been confirmed.
Identity is considered to be confirmed if authorization succeeds.
Possible values are <code>Confirmed</code> and <code>Indeterminate</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If delegation is enabled, then the <code>X-Delegated</code> header is created.
This is mainly intended for use by the <a href="herp.html">Highly Efficient Record Processor (HERP) filter</a> and <a href="derp.html">Delegation Response Processor (DeRP) filter</a> for internal delegation processing within <strong>Repose</strong>.
However, it can be exposed to the origin service under certain configurations.</p>
</div>
</div>
<div class="sect2">
<h3 id="request-body-changes"><a class="anchor" href="#request-body-changes"></a>Request Body Changes</h3>
<div class="paragraph">
<p>This filter does not modify the request body.</p>
</div>
</div>
<div class="sect2">
<h3 id="recommended-follow-on-succeeding-filters"><a class="anchor" href="#recommended-follow-on-succeeding-filters"></a>Recommended Follow-On (Succeeding) Filters</h3>
<div class="paragraph">
<p>This filter is not strictly required by any other filters.
However, the following filters may be useful:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="simple-rbac.html">Simple RBAC filter</a> - Provides role-based access control to the origin service&#8217;s API, making use of the culled <code>X-Roles</code> and <code>X-Map-Roles</code> headers.</p>
</li>
<li>
<p><a href="api-validator.html">API Validator filter</a> - Provides role-based access control to the origin service&#8217;s API, making use of the culled <code>X-Roles</code> and <code>X-Map-Roles</code> headers.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="response-body-changes"><a class="anchor" href="#response-body-changes"></a>Response Body Changes</h3>
<div class="paragraph">
<p>This filter does not modify the response body.</p>
</div>
</div>
<div class="sect2">
<h3 id="response-headers-created"><a class="anchor" href="#response-headers-created"></a>Response Headers Created</h3>
<div class="paragraph">
<p>This filter does not create/modify any response headers.</p>
</div>
</div>
<div class="sect2">
<h3 id="response-status-codes"><a class="anchor" href="#response-status-codes"></a>Response Status Codes</h3>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 1. Status Codes</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Status Code</th>
<th class="tableblock halign-left valign-top">Reasons</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>401</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tenant ID validation fails because the request tenant ID does not match any tenant ID in the user data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>403</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endpoint validation fails because the user data does not contain a required endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>500</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid user data (i.e., tenant-to-roles map and endpoint data) was not found in the request.
The most likely cause is that the <a href="keystone-v2.html">Keystone v2 Filter</a> had not been set up correctly.
Note that the <code>set-roles-in-header</code> and <code>set-catalog-in-header</code> attributes must be set to true for the tenant-to-roles map and endpoints to be forwarded respectively.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="tenant-validation"><a class="anchor" href="#tenant-validation"></a>Tenant Validation</h3>
<div class="paragraph">
<p>This configuration will validate the tenant ID(s) in the request against the tenant ID(s) in the user data.
All tenants extracted from the request <em>must</em> have at least one matching tenant in the user data.</p>
</div>
<div class="listingblock">
<div class="title">keystone-v2-authorization.cfg.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#579">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span style="color:#070;font-weight:bold">&lt;keystone-v2-authorization</span> <span style="color:#b48">xmlns</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://docs.openrepose.org/repose/keystone-v2/v1.0</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;tenant-handling</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span style="color:#b48">send-all-tenant-ids</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">true</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>

        <span style="color:#070;font-weight:bold">&lt;validate-tenant</span> <i class="conum" data-value="3"></i><b>(3)</b>
            <span style="color:#b48">strip-token-tenant-prefixes</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/foo:/bar-</span><span style="color:#710">&quot;</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
            <span style="color:#b48">enable-legacy-roles-mode</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">false</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span> <i class="conum" data-value="5"></i><b>(5)</b>

            <span style="color:#070;font-weight:bold">&lt;uri-extraction-regex&gt;</span>.*/servers/([-|\w]+)/?.*<span style="color:#070;font-weight:bold">&lt;/uri-extraction-regex&gt;</span> <i class="conum" data-value="6"></i><b>(6)</b>
            <span style="color:#070;font-weight:bold">&lt;uri-extraction-regex&gt;</span>.*/clients/([-|\w]+)/?.*<span style="color:#070;font-weight:bold">&lt;/uri-extraction-regex&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header-extraction-name&gt;</span>x-expected-tenant<span style="color:#070;font-weight:bold">&lt;/header-extraction-name&gt;</span> <i class="conum" data-value="7"></i><b>(7)</b>
            <span style="color:#070;font-weight:bold">&lt;header-extraction-name&gt;</span>x-other-tenant<span style="color:#070;font-weight:bold">&lt;/header-extraction-name&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/validate-tenant&gt;</span>

        <span style="color:#070;font-weight:bold">&lt;send-tenant-id-quality</span> <i class="conum" data-value="8"></i><b>(8)</b>
            <span style="color:#b48">default-tenant-quality</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1.0</span><span style="color:#710">&quot;</span></span> <i class="conum" data-value="9"></i><b>(9)</b>
            <span style="color:#b48">uri-tenant-quality</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">0.7</span><span style="color:#710">&quot;</span></span> <i class="conum" data-value="10"></i><b>(10)</b>
            <span style="color:#b48">roles-tenant-quality</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">0.5</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span> <i class="conum" data-value="11"></i><b>(11)</b>
    <span style="color:#070;font-weight:bold">&lt;/tenant-handling&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/keystone-v2-authorization&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A container for functionality pertaining to tenant handling.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicates if all the Tenant IDs from the user and the roles the user has should be sent or not.<br>
Default: <code>false</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If included, then the user will be authorized if and only if the user data contains a tenant ID matching the tenant ID extracted from the request.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A <code>/</code> delimited list of prefixes to attempt to strip from the Tenant ID in the token response from the Keystone v2 Identity service.
The post-strip Tenant ID is only used in the Tenant Validation check.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If in legacy roles mode, then all roles associated with a user token are forwarded.
If NOT in legacy roles mode, then roles which aren&#8217;t tied to the tenant provided in the request will NOT be forwarded UNLESS the user has a pre-authorized role.<br>
Default: <code>false</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Declares that a tenant ID should be extracted from the request URI.
A <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java Regular Expression</a> with at least one capture group.
The first capture group must be around the portion of the URI to extract the Tenant ID from for validation.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Declares that a tenant ID should be extracted from the <code>x-expected-tenant</code> header in the request.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>If this element is included, then include Quality parameters on all the tenant ID headers sent.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>The default tenant has the highest quality by default.
Since this filter does not set the default tenant, this value is not currently used by the this filter.<br>
Default: <code>0.9</code></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Followed by matching request tenants by default (if any).<br>
Default: <code>0.7</code></td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Followed by the tenants from the roles by default.
Since this filter does not set the roles tenants, this value is not currently used by the this filter.<br>
Default: <code>0.5</code>
<div class="literalblock">
<div class="content">
<pre>[WARNING]
====
The `uri-extraction-regex` attribute is considered deprecated.
Consider using the &lt;&lt;url-extractor-to-header.adoc#, URL Extractor to Header Filter&gt;&gt; instead.
====</pre>
</div>
</div></td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="endpoint-validation"><a class="anchor" href="#endpoint-validation"></a>Endpoint Validation</h3>
<div class="paragraph">
<p>This configuration will validate that the user data contains a configured endpoint.</p>
</div>
<div class="listingblock">
<div class="title">keystone-v2-authorization.cfg.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#579">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span style="color:#070;font-weight:bold">&lt;keystone-v2-authorization</span> <span style="color:#b48">xmlns</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://docs.openrepose.org/repose/keystone-v2/v1.0</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;require-service-endpoint</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span style="color:#b48">public-url</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">https://service.example.com</span><span style="color:#710">&quot;</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span style="color:#b48">region</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ORD</span><span style="color:#710">&quot;</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">OpenStackCompute</span><span style="color:#710">&quot;</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
        <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">compute</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span> <i class="conum" data-value="5"></i><b>(5)</b>
<span style="color:#070;font-weight:bold">&lt;/keystone-v2-authorization&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If included, then the user will be authorized if and only if the user data contains an endpoint matching the configured endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Public URL to match on the user&#8217;s endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Region to match on the user&#8217;s endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Name of the service to match in the user&#8217;s endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Type to match in the user&#8217;s endpoint.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="whitelisting-uris"><a class="anchor" href="#whitelisting-uris"></a>Whitelisting URIs</h3>
<div class="paragraph">
<p>You can configure this filter to allow no-op processing of requests that do not require authorization.
For example, a service might want all calls authorized with the exception of the call for WADL retrieval.
In this situation, you can configure the whitelist as shown in the example below.
The whitelist contains a list of <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java Regular Expressions</a> that <strong>Repose</strong> attempts to match against the full request URI.
If the URI matches an expression in the white list, then the request is passed to the origin service.
Otherwise, authorization is performed against the request.</p>
</div>
<div class="listingblock">
<div class="title">keystone-v2-authorization.cfg.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#579">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span style="color:#070;font-weight:bold">&lt;keystone-v2-authorization</span> <span style="color:#b48">xmlns</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://docs.openrepose.org/repose/keystone-v2/v1.0</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;white-list&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;uri-regex&gt;</span>/application\.wadl$<span style="color:#070;font-weight:bold">&lt;/uri-regex&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span style="color:#070;font-weight:bold">&lt;/white-list&gt;</span>

    <span style="color:#070;font-weight:bold">&lt;tenant-handling&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;validate-tenant&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header-extraction-name&gt;</span>x-expected-tenant<span style="color:#070;font-weight:bold">&lt;/header-extraction-name&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/validate-tenant&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/tenant-handling&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/keystone-v2-authorization&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java Regular Expression</a> to allow matching URI&#8217;s to pass without requiring authorization.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pre-authorized-roles"><a class="anchor" href="#pre-authorized-roles"></a>Pre-authorized Roles</h3>
<div class="paragraph">
<p>Pre-authorized roles can be configured to allow a user to bypass authorization if the user data contains a role matching one of the pre-authorized roles.</p>
</div>
<div class="listingblock">
<div class="title">keystone-v2-authorization.cfg.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#579">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span style="color:#070;font-weight:bold">&lt;keystone-v2-authorization</span> <span style="color:#b48">xmlns</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://docs.openrepose.org/repose/keystone-v2/v1.0</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;pre-authorized-roles&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span style="color:#070;font-weight:bold">&lt;role&gt;</span>racker<span style="color:#070;font-weight:bold">&lt;/role&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span style="color:#070;font-weight:bold">&lt;/pre-authorized-roles&gt;</span>

    <span style="color:#070;font-weight:bold">&lt;tenant-handling&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;validate-tenant&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header-extraction-name&gt;</span>x-expected-tenant<span style="color:#070;font-weight:bold">&lt;/header-extraction-name&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/validate-tenant&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/tenant-handling&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/keystone-v2-authorization&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contains pre-authorized roles.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Defines a role for which authorization is not performed.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="delegation"><a class="anchor" href="#delegation"></a>Delegation</h3>
<div class="paragraph">
<p>In some cases, you may want to delegate the decision to reject a request down the chain to either another filter or to the origin service.
This filter allows a request to pass as either <code>Confirmed</code> or <code>Indeterminate</code> when configured to run in delegating mode.
To place the filter in delegating mode, add the <code>delegating</code> element to the filter configuration with an optional <code>quality</code> attribute that determines the delegation priority.
When in delegating mode, the filter sets the <code>X-Identity-Status</code> header with a value of <code>Confirmed</code> when a user has been authorized by the this filter and to <code>Indeterminate</code> when a user was not authorized by this filter.
The the <code>X-Identity-Status</code> header is in addition to the regular <code>X-Delegated</code> delegation header being created.</p>
</div>
<div class="listingblock">
<div class="title">keystone-v2-authorization.cfg.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#579">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span style="color:#070;font-weight:bold">&lt;keystone-v2-authorization</span> <span style="color:#b48">xmlns</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://docs.openrepose.org/repose/keystone-v2/v1.0</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;delegating</span> <span style="color:#b48">quality</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">0.7</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>

    <span style="color:#070;font-weight:bold">&lt;tenant-handling&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;validate-tenant&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header-extraction-name&gt;</span>x-expected-tenant<span style="color:#070;font-weight:bold">&lt;/header-extraction-name&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/validate-tenant&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/tenant-handling&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/keystone-v2-authorization&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If this element is present, then delegation is enabled.
Delegation will cause this filter to pass requests it would ordinarily reject along with a header detailing why it would have rejected the request.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicates the quality that will be added to any output headers.
When setting up a chain of delegating filters the highest quality number will be the one that is eventually output to the logging mechanisms.<br>
Default: <code>0.7</code></td>
</tr>
</table>
</div>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="/_javascripts/page-loader.js" type="text/javascript"></script>
  <script src="/_javascripts/include-html.js" type="text/javascript"></script>
  <script>includeHTML();</script>
  <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>