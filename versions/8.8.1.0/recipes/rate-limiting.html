<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>8.8.1.0 | Recipes | Rate Limiting</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="/_stylesheets/asciibinder.css" >
  <link rel="stylesheet" href="/_stylesheets/repose.css" >

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body onload="selectVersion('8.8.1.0');">
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a class="navbar-brand" href="http://www.openrepose.org/">
          <img alt="OpenRepose" src="/_images/repose-logo.png" align="bottom">
        </a>
      </li>
      <li class="sitename">
        <a href="../../index.html">
          Home
        </a>
      </li>
      <li class="hidden-xs active">
        <a href="/versions/8.8.1.0/welcome/index.html">
          Repose
        </a>
        <select id="version-selector" onchange="versionSelector(this);" w3-include-html="/_includes/versions.html">
        </select>
      </li>
      <li class="hidden-xs active">
        <a href="../recipes/index.html">Recipes</a>
      </li>
      
      <li class="hidden-xs active">
        Rate Limiting
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <a class="navbar-search" href="/versions/search.html">
          <span class="glyphicon glyphicon-search"/>
          Search
        </a>
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>Welcome to Repose
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../welcome/index.html">Welcome</a></li>
            <li><a class="" href="../welcome/troubleshooting.html">Troubleshooting</a></li>
            <li><a class="" href="../welcome/release-notes.html">Release Notes</a></li>
            <li><a class="" href="../welcome/style-guide.html">Style Guide</a></li>
            <li><a class="" href="../welcome/faq.html">FAQ</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>Architecture
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../architecture/index.html">Overview</a></li>
            <li><a class="" href="../architecture/configuration.html">Configuration</a></li>
            <li><a class="" href="../architecture/container.html">Container</a></li>
            <li><a class="" href="../architecture/packages.html">Packages</a></li>
            <li><a class="" href="../architecture/system-model.html">System Model</a></li>
            <li><a class="" href="../architecture/performance.html">Performance</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-down"></span>Recipes
      </a>
      <ul id="topicGroup2" class="collapse in list-unstyled">
            <li><a class="" href="../recipes/index.html">Overview</a></li>
            <li><a class="" href="../recipes/quick-start.html">Quick Start</a></li>
            <li><a class="" href="../recipes/getting-started.html">Getting Started</a></li>
            <li><a class="" href="../recipes/custom-filter-for-repose.html">Custom Filter for Repose</a></li>
            <li><a class="" href="../recipes/docker.html">Docker</a></li>
            <li><a class="" href="../recipes/performance-best-practices.html">Performance Best Practices</a></li>
            <li><a class="" href="../recipes/role-based-access-control.html">Role Based Access Control</a></li>
            <li><a class="" href="../recipes/running-valve.html">Running Valve</a></li>
            <li><a class="" href="../recipes/valve-installation.html">Valve Installation</a></li>
            <li><a class="" href="../recipes/war-installation.html">WAR Installation</a></li>
            <li><a class="" href="../recipes/echo-server.html">Echo Server</a></li>
            <li><a class=" active" href="../recipes/rate-limiting.html">Rate Limiting</a></li>
            <li><a class="" href="../recipes/user-access-events.html">User Access Events</a></li>
            <li><a class="" href="../recipes/basic-authentication.html">Basic Authentication</a></li>
            <li><a class="" href="../recipes/delegation.html">Delegation</a></li>
            <li><a class="" href="../recipes/preventing-xml-bomb.html">Preventing XML bomb attacks</a></li>
            <li><a class="" href="../recipes/api-event-flume.html">API Access Event Recording with Flume</a></li>
            <li><a class="" href="../recipes/xsd-versioning.html">XSD Versioning Guidelines</a></li>
            <li><a class="" href="../recipes/client-authentication.html">SSL/TLS Client Authentication</a></li>
            <li><a class="" href="../recipes/functional-test-framework.html">Functional Test Framework</a></li>
            <li><a class="" href="../recipes/glassfish-setup.html">Glassfish Setup</a></li>
            <li><a class="" href="../recipes/tomcat-setup.html">Tomcat Setup</a></li>
            <li><a class="" href="../recipes/http-container-attributes.html">HTTP Container Attributes</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-right"></span>Filters
      </a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../filters/index.html">Overview</a></li>
            <li><a class="" href="../filters/add-header.html">Add Header Filter</a></li>
            <li><a class="" href="../filters/api-validator.html">API Validator Filter</a></li>
            <li><a class="" href="../filters/attribute-mapping-policy-validation.html">Attribute Mapping Policy Validation filter</a></li>
            <li><a class="" href="../filters/body-extractor-to-header.html">Body Extractor to Header Filter</a></li>
            <li><a class="" href="../filters/body-patcher.html">Body Patcher Filter</a></li>
            <li><a class="" href="../filters/compression.html">Compression Filter</a></li>
            <li><a class="" href="../filters/content-type-stripper.html">Content Type Stripper Filter</a></li>
            <li><a class="" href="../filters/cors.html">CORS Filter</a></li>
            <li><a class="" href="../filters/derp.html">Delegation Response Processor (DeRP) Filter</a></li>
            <li><a class="" href="../filters/destination-router.html">Destination Router Filter</a></li>
            <li><a class="" href="../filters/echo.html">Echo Filter</a></li>
            <li><a class="" href="../filters/exception.html">Exception Filter</a></li>
            <li><a class="" href="../filters/forwarded-proto.html">Forwarded Protocol Filter</a></li>
            <li><a class="" href="../filters/header-normalization.html">Header Normalization filter</a></li>
            <li><a class="" href="../filters/header-translation.html">Header Translation Filter</a></li>
            <li><a class="" href="../filters/header-user.html">Header User Filter</a></li>
            <li><a class="" href="../filters/herp.html">Highly Efficient Record Processor (HERP) Filter</a></li>
            <li><a class="" href="../filters/ip-user.html">IP User Filter</a></li>
            <li><a class="" href="../filters/iri-validator.html">IRI Validator Filter</a></li>
            <li><a class="" href="../filters/keystone-v2.html">Keystone v2 Filter</a></li>
            <li><a class="" href="../filters/keystone-v2-authorization.html">Keystone v2 Authorization Filter</a></li>
            <li><a class="" href="../filters/keystone-v2-basic-auth.html">Keystone v2 Basic Auth Filter</a></li>
            <li><a class="" href="../filters/merge-header.html">Merge Header Filter</a></li>
            <li><a class="" href="../filters/openstack-identity-v3.html">Openstack Identity v3 Filter</a></li>
            <li><a class="" href="../filters/rackspace-auth-user.html">Rackspace Auth User Filter</a></li>
            <li><a class="" href="../filters/rate-limiting.html">Rate Limiting Filter</a></li>
            <li><a class="" href="../filters/regex-rbac.html">RegEx Role Based Access Control (RBAC) Filter</a></li>
            <li><a class="" href="../filters/saml-policy.html">SAML Policy Translation Filter</a></li>
            <li><a class="" href="../filters/scripting.html">Scripting Filter</a></li>
            <li><a class="" href="../filters/simple-rbac.html">Simple Role Based Access Control (RBAC) Filter</a></li>
            <li><a class="" href="../filters/slf4j-http-logging.html">SFL4J HTTP Logging Filter</a></li>
            <li><a class="" href="../filters/tenant-culling.html">Tenant Culling Filter</a></li>
            <li><a class="" href="../filters/translation.html">Translation Filter</a></li>
            <li><a class="" href="../filters/uri-normalization.html">URI Normalization Filter</a></li>
            <li><a class="" href="../filters/uri-stripper.html">URI Stripper Filter</a></li>
            <li><a class="" href="../filters/uri-user.html">URI User Filter</a></li>
            <li><a class="" href="../filters/url-extractor-to-header.html">URL Extractor to Header Filter</a></li>
            <li><a class="" href="../filters/valkyrie-authorization.html">Valkyrie Authorization Filter</a></li>
            <li><a class="" href="../filters/versioning.html">Versioning Filter</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-right"></span>Services
      </a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../services/index.html">Overview</a></li>
            <li><a class="" href="../services/atom-feed-consumption.html">Atom Feed Consumption Service</a></li>
            <li><a class="" href="../services/datastores.html">Datastores</a></li>
            <li><a class="" href="../services/health-check.html">Health Check service</a></li>
            <li><a class="" href="../services/http-connection-pool.html">HTTP Connection Pool service</a></li>
            <li><a class="" href="../services/metrics.html">Metrics Service</a></li>
            <li><a class="" href="../services/phone-home.html">Phone Home Service</a></li>
            <li><a class="" href="../services/response-messaging.html">Response Messaging service</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup5">
        <span id="tgSpan5" class="fa fa-angle-right"></span>Developer
      </a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li><a class="" href="../developer/index.html">Overview</a></li>
            <li><a class="" href="../developer/docker.html">Docker</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Rate Limiting</h2>
        </div>
        <div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A common use case for <strong>Repose</strong> is rate limiting.
It limits how many requests per some unit of time (e.g., 10 requests per minute) are allowed to be made.
In this recipe, we&#8217;ll be using the <code>X-PP-User</code> header to indicate who we are for rate limiting purposes.
For additional info on populating that header and on rate limiting by groups, see the <a href="../filters/rate-limiting.html">Rate Limiting Filter</a> documentation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="system-model"><a class="anchor" href="#system-model"></a>System Model</h3>
<div class="paragraph">
<p>The filter can be enabled by adding it to the list of filters in the <a href="../architecture/system-model.html">System Model</a>.</p>
</div>
<div class="listingblock">
<div class="title">system-model.cfg.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#579">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span style="color:#777">&lt;!-- To configure Repose see: http://wiki.openrepose.org/display/REPOSE/Configuration --&gt;</span>
<span style="color:#070;font-weight:bold">&lt;system-model</span> <span style="color:#b48">xmlns</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://docs.openrepose.org/repose/system-model/v2.0</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;repose-cluster</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">repose</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
    ...
    <span style="color:#070;font-weight:bold">&lt;filters&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;filter</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">rate-limiting</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/filters&gt;</span>
    ...
<span style="color:#070;font-weight:bold">&lt;/system-model&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rate-limiting"><a class="anchor" href="#rate-limiting"></a>Rate Limiting</h3>
<div class="paragraph">
<p>After the filter has been added to the <a href="../architecture/system-model.html">System Model</a>, the example configuration can copied/moved from the examples directory to the <a href="../architecture/configuration.html">configuration files directory</a>.
The example configuration for rate limiting is sufficient for testing and will limit requests to the origin service to 10 times per minute.</p>
</div>
<div class="listingblock">
<div class="title">rate-limiting.cfg.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#579">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span style="color:#070;font-weight:bold">&lt;rate-limiting</span> <span style="color:#b48">xmlns</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://docs.openrepose.org/repose/rate-limiting/v1.0</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
    <span style="color:#777">&lt;!--
        Defines an endpoint with a matching regex to bind GET requests for
        returning live rate limiting information.
    --&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;request-endpoint</span> <span style="color:#b48">uri-regex</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/limits</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">include-absolute-limits</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">true</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>

    <span style="color:#777">&lt;!-- Protects the Origin Service from being flooded. --&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;global-limit-group&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;limit</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">global</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">uri</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">*</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">uri-regex</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">.*</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1000</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">unit</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">MINUTE</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/global-limit-group&gt;</span>

    <span style="color:#777">&lt;!-- Limits for all other requests --&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;limit-group</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">limited</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">groups</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">limited</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">default</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">true</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;limit</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">get</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">uri</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/service/*</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">uri-regex</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/service/([\d^/]*)/.*</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">http-methods</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">GET</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">unit</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">SECOND</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;limit</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">put</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">uri</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/service/*</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">uri-regex</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/service/([\d^/]*)/.*</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">http-methods</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">PUT</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">unit</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">MINUTE</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">5</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;limit</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">post</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">uri</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/service/*</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">uri-regex</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/service/([\d^/]*)/.*</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">http-methods</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">POST</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">unit</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">HOUR</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">15</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;limit</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">delete</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">uri</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/service/*</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">uri-regex</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/service/([\d^/]*)/.*</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">http-methods</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">DELETE</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">unit</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">DAY</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">2</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;limit</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">all</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">uri</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">*</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">uri-regex</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/.*</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">http-methods</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">POST PUT GET DELETE</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">unit</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">MINUTE</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">10</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/limit-group&gt;</span>

    <span style="color:#777">&lt;!-- Limits for WhiteListed IPs --&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;limit-group</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">unlimited</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">groups</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">unlimited</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">default</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">false</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>

<span style="color:#070;font-weight:bold">&lt;/rate-limiting&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing"><a class="anchor" href="#testing"></a>Testing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="script"><a class="anchor" href="#script"></a>Script</h3>
<div class="paragraph">
<p>You can use this script to quickly make 11 requests to <strong>Repose</strong> to confirm that rate limiting is working.</p>
</div>
<div class="listingblock">
<div class="title">test_rate_limiting.sh</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">#!/bin/bash
OUT_FILE=&quot;repose-curl.out&quot;
rm -f $OUT_FILE
touch $OUT_FILE
for i in {1..11} ; do
  echo -en &quot;\n\n~~~~~ Attempt #$i ~~~~~\n\n&quot; &gt;&gt; $OUT_FILE
  curl -H &quot;x-pp-user: abc123&quot; -H &quot;Content-Type: Test&quot; -H &quot;Content-Length: 0&quot; localhost:8080/get -v &gt;&gt; $OUT_FILE 2&gt;&amp;1
done</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running"><a class="anchor" href="#running"></a>Running</h3>
<div class="paragraph">
<p>Assuming you named the script <code>test_rate_limiting.sh</code>, you can run it with the following:</p>
</div>
<div class="listingblock">
<div class="title">console session</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell"># make the script executable
chmod +x test_rate_limiting.sh

# run the script
./test_rate_limiting.sh

# view the results
less repose-curl.out</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="results"><a class="anchor" href="#results"></a>Results</h3>
<div class="paragraph">
<p>You should see the first 10 attempts succeed with a 200 and the 11th attempt fail with a 413.
A sample of the 11th attempt output is below.</p>
</div>
<div class="listingblock">
<div class="title">console session</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">~~~~~ Attempt #11 ~~~~~
* Hostname was NOT found in DNS cache
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
^M  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying ::1...
* Connected to localhost (::1) port 8080 (#0)
&gt; GET /get HTTP/1.1
&gt; User-Agent: curl/7.35.0
&gt; Host: localhost:8080
&gt; Accept: */*
&gt; x-pp-user: abc123
&gt; Content-Type: Test
&gt; Content-Length: 0
&gt;
&lt; HTTP/1.1 413 Request Entity Too Large
&lt; Date: Wed, 02 Dec 2015 04:59:28 GMT
&lt; Retry-After: Wed, 02 Dec 2015 05:00:28 GMT
&lt; Content-Type: application/json
&lt; Via: 1.1 Repose (Repose/7.2.2.0)
&lt; x-trans-id: eyJyZXF1ZXN0SWQiOiJjMWQxYmU0Ny1iOTYwLTQxZTAtYTY0My03NWQzNDNhNTJlNjciLCJvcmlnaW4iOm51bGx9
&lt; Content-Length: 223
* Server Jetty(9.2.z-SNAPSHOT) is not blacklisted
&lt; Server: Jetty(9.2.z-SNAPSHOT)
&lt;
{ [data not shown]
^M100   223  100   223    0     0  11081      0 --:--:-- --:--:-- --:--:-- 11150
* Connection #0 to host localhost left intact
{
    &quot;overLimit&quot; : {
        &quot;code&quot; : 413,
        &quot;message&quot; : &quot;OverLimit Retry...&quot;,
        &quot;details&quot; : &quot;Error Details...&quot;,
        &quot;retryAfter&quot; : &quot;2015-12-02T05:00:28Z&quot;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is real handy if you have a single <strong>Repose</strong> node, however if you scale your <strong>Repose</strong> cluster horizontally, then you will need to configure for Distributed Rate Limiting for it to behave as you would expect it to.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="distributed-rate-limiting"><a class="anchor" href="#distributed-rate-limiting"></a>Distributed Rate Limiting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If no <a href="../services/datastores.html">Distributed Datastores</a> are available, then rate limiting will use the local datastore and each node will allow the configured rate through.
This is not typically the desired behavior and is easily remedied.
By default, rate limiting will be distributed using the standard <a href="../services/datastores.html#_distributed_datastore">Distributed Datastore</a> (<code>hash-ring</code>) if it is available.
However, the <a href="../services/datastores.html#_distributed_datastore">Distributed Datastore</a> must be enabled in the <a href="../architecture/system-model.html">System Model</a>.
Furthermore, any of the datastore types can be used to store rate limiting information.
The <a href="../services/datastores.html">Distributed Datastore</a> documentation has more information on how to properly enable and configure them.</p>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="/_javascripts/page-loader.js" type="text/javascript"></script>
  <script src="/_javascripts/include-html.js" type="text/javascript"></script>
  <script>includeHTML();</script>
  <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>