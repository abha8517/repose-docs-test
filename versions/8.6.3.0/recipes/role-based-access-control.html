<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>8.6.3.0 | Recipes | Role Based Access Control</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="/_stylesheets/asciibinder.css" >
  <link rel="stylesheet" href="/_stylesheets/repose.css" >

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body onload="selectVersion('8.6.3.0');">
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a class="navbar-brand" href="http://www.openrepose.org/">
          <img alt="OpenRepose" src="/_images/repose-logo.png" align="bottom">
        </a>
      </li>
      <li class="sitename">
        <a href="../../index.html">
          Home
        </a>
      </li>
      <li class="hidden-xs active">
        <a href="/versions/8.6.3.0/welcome/index.html">
          Repose
        </a>
        <select id="version-selector" onchange="versionSelector(this);" w3-include-html="/_includes/versions.html">
        </select>
      </li>
      <li class="hidden-xs active">
        <a href="../recipes/index.html">Recipes</a>
      </li>
      
      <li class="hidden-xs active">
        Role Based Access Control
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <a class="navbar-search" href="/versions/search.html">
          <span class="glyphicon glyphicon-search"/>
          Search
        </a>
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>Welcome to Repose
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../welcome/index.html">Welcome</a></li>
            <li><a class="" href="../welcome/troubleshooting.html">Troubleshooting</a></li>
            <li><a class="" href="../welcome/release-notes.html">Release Notes</a></li>
            <li><a class="" href="../welcome/style-guide.html">Style Guide</a></li>
            <li><a class="" href="../welcome/faq.html">FAQ</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>Architecture
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../architecture/index.html">Overview</a></li>
            <li><a class="" href="../architecture/configuration.html">Configuration</a></li>
            <li><a class="" href="../architecture/container.html">Container</a></li>
            <li><a class="" href="../architecture/packages.html">Packages</a></li>
            <li><a class="" href="../architecture/system-model.html">System Model</a></li>
            <li><a class="" href="../architecture/performance.html">Performance</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-down"></span>Recipes
      </a>
      <ul id="topicGroup2" class="collapse in list-unstyled">
            <li><a class="" href="../recipes/index.html">Overview</a></li>
            <li><a class="" href="../recipes/quick-setup.html">Quick Setup</a></li>
            <li><a class="" href="../recipes/getting-started.html">Getting Started</a></li>
            <li><a class="" href="../recipes/custom-filter-for-repose.html">Custom Filter for Repose</a></li>
            <li><a class="" href="../recipes/docker.html">Docker</a></li>
            <li><a class="" href="../recipes/performance-best-practices.html">Performance Best Practices</a></li>
            <li><a class=" active" href="../recipes/role-based-access-control.html">Role Based Access Control</a></li>
            <li><a class="" href="../recipes/running-valve.html">Running Valve</a></li>
            <li><a class="" href="../recipes/vagrant.html">Vagrant</a></li>
            <li><a class="" href="../recipes/valve-installation.html">Valve Installation</a></li>
            <li><a class="" href="../recipes/war-installation.html">WAR Installation</a></li>
            <li><a class="" href="../recipes/echo-server.html">Echo Server</a></li>
            <li><a class="" href="../recipes/rate-limiting.html">Rate Limiting</a></li>
            <li><a class="" href="../recipes/user-access-events.html">User Access Events</a></li>
            <li><a class="" href="../recipes/basic-authentication.html">Basic Authentication</a></li>
            <li><a class="" href="../recipes/distributed-rate-limiting.html">Distributed Rate Limiting</a></li>
            <li><a class="" href="../recipes/delegation.html">Delegation</a></li>
            <li><a class="" href="../recipes/preventing-xml-bomb.html">Preventing XML bomb attacks</a></li>
            <li><a class="" href="../recipes/api-event-flume.html">API Access Event Recording with Flume</a></li>
            <li><a class="" href="../recipes/xsd-versioning.html">XSD Versioning Guidelines</a></li>
            <li><a class="" href="../recipes/client-authentication.html">SSL/TLS Client Authentication</a></li>
            <li><a class="" href="../recipes/functional-test-framework.html">Functional Test Framework</a></li>
            <li><a class="" href="../recipes/glassfish-setup.html">Glassfish Setup</a></li>
            <li><a class="" href="../recipes/tomcat-setup.html">Tomcat Setup</a></li>
            <li><a class="" href="../recipes/http-container-attributes.html">HTTP Container Attributes</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-right"></span>Filters
      </a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../filters/index.html">Overview</a></li>
            <li><a class="" href="../filters/add-header.html">Add Header Filter</a></li>
            <li><a class="" href="../filters/api-validator.html">API Validator Filter</a></li>
            <li><a class="" href="../filters/attribute-mapping-policy-validation.html">Attribute Mapping Policy Validation filter</a></li>
            <li><a class="" href="../filters/body-extractor-to-header.html">Body Extractor to Header Filter</a></li>
            <li><a class="" href="../filters/body-patcher.html">Body Patcher Filter</a></li>
            <li><a class="" href="../filters/compression.html">Compression Filter</a></li>
            <li><a class="" href="../filters/content-type-stripper.html">Content Type Stripper Filter</a></li>
            <li><a class="" href="../filters/cors.html">CORS Filter</a></li>
            <li><a class="" href="../filters/derp.html">Delegation Response Processor (DeRP) Filter</a></li>
            <li><a class="" href="../filters/destination-router.html">Destination Router Filter</a></li>
            <li><a class="" href="../filters/echo.html">Echo Filter</a></li>
            <li><a class="" href="../filters/exception.html">Exception Filter</a></li>
            <li><a class="" href="../filters/forwarded-proto.html">Forwarded Protocol Filter</a></li>
            <li><a class="" href="../filters/header-normalization.html">Header Normalization filter</a></li>
            <li><a class="" href="../filters/header-translation.html">Header Translation Filter</a></li>
            <li><a class="" href="../filters/header-user.html">Header User Filter</a></li>
            <li><a class="" href="../filters/herp.html">Highly Efficient Record Processor (HERP) Filter</a></li>
            <li><a class="" href="../filters/ip-user.html">IP User Filter</a></li>
            <li><a class="" href="../filters/iri-validator.html">IRI Validator Filter</a></li>
            <li><a class="" href="../filters/keystone-v2.html">Keystone v2 Filter</a></li>
            <li><a class="" href="../filters/keystone-v2-basic-auth.html">Keystone v2 Basic Auth Filter</a></li>
            <li><a class="" href="../filters/merge-header.html">Merge Header Filter</a></li>
            <li><a class="" href="../filters/openstack-identity-v3.html">Openstack Identity v3 Filter</a></li>
            <li><a class="" href="../filters/rackspace-auth-user.html">Rackspace Auth User Filter</a></li>
            <li><a class="" href="../filters/rate-limiting.html">Rate Limiting Filter</a></li>
            <li><a class="" href="../filters/saml-policy.html">SAML Policy Translation Filter</a></li>
            <li><a class="" href="../filters/scripting.html">Scripting Filter</a></li>
            <li><a class="" href="../filters/simple-rbac.html">Simple Role Based Access Control (RBAC) Filter</a></li>
            <li><a class="" href="../filters/slf4j-http-logging.html">SFL4J HTTP Logging Filter</a></li>
            <li><a class="" href="../filters/translation.html">Translation Filter</a></li>
            <li><a class="" href="../filters/uri-normalization.html">URI Normalization Filter</a></li>
            <li><a class="" href="../filters/uri-stripper.html">URI Stripper Filter</a></li>
            <li><a class="" href="../filters/uri-user.html">URI User Filter</a></li>
            <li><a class="" href="../filters/url-extractor-to-header.html">URL Extractor to Header Filter</a></li>
            <li><a class="" href="../filters/valkyrie-authorization.html">Valkyrie Authorization Filter</a></li>
            <li><a class="" href="../filters/versioning.html">Versioning Filter</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-right"></span>Services
      </a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../services/index.html">Overview</a></li>
            <li><a class="" href="../services/atom-feed-consumption.html">Atom Feed Consumption Service</a></li>
            <li><a class="" href="../services/datastores.html">Datastores</a></li>
            <li><a class="" href="../services/health-check.html">Health Check service</a></li>
            <li><a class="" href="../services/http-connection-pool.html">HTTP Connection Pool service</a></li>
            <li><a class="" href="../services/metrics.html">Metrics Service</a></li>
            <li><a class="" href="../services/phone-home.html">Phone Home Service</a></li>
            <li><a class="" href="../services/response-messaging.html">Response Messaging service</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Implementing Role-Based Access Control (RBAC)</h2>
        </div>
        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>You can implement Role-Based Access Control (RBAC) with Repose with the Header Normalization, the Authorization, and the API Validator filters.
This guide takes you through the process of setting up RBAC with Repose.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="1-configure-the-header-normalization-filter"><a class="anchor" href="#1-configure-the-header-normalization-filter"></a>1. Configure the Header Normalization filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To prevent users from submitting their own roles, you will need to blacklist headers using the Header Normalization filter.</p>
</div>
<div class="listingblock">
<div class="title">header-normalization.cfg.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;header-filters&gt;</span>
...
    <span style="color:#070;font-weight:bold">&lt;target&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;blacklist</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ReposeHeaders</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">X-Authorization</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">X-Identity-Status</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">X-Impersonator-Id</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">X-Impersonator-Name</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">X-PP-Groups</span><span style="color:#710">&quot;</span></span> <span style="color:#070;font-weight:bold">/&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">X-PP-User</span><span style="color:#710">&quot;</span></span> <span style="color:#070;font-weight:bold">/&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">X-Roles</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">X-Tenant-Id</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">X-Tenant-Name</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">X-User-Id</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;header</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">X-User-Name</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/blacklist&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;target&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/header-filters&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please refer to the <a href="../filters/header-normalization.html">Header Normalization filter</a> documentation for more information about the available configuration options.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="2-configure-then-authentication-filter"><a class="anchor" href="#2-configure-then-authentication-filter"></a>2. Configure then Authentication filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Authentication filter will grab the user&#8217;s roles from their authentication token and return those roles to Repose.</p>
</div>
<div class="paragraph">
<p>Please refer to the <a href="../filters/keystone-v2.html">Keystone v2 filter</a> documentation for more information about the available configuration options.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="3-configure-the-rbac-filter"><a class="anchor" href="#3-configure-the-rbac-filter"></a>3. Configure the RBAC filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two mechanisms for doing the authorization side.
If your API is minimal or your just getting started with it, then you might find the Simple RBAC filter most useful.
It uses a very simple Domain Specific Language (DSL) that is similar to what other tools use for this basic mechanism.
If on the other had your API is large and/or your authorizations are complex, then you will need the heavy lifting of the API Validation filter.
Since the Simple way is very self explanatory, we will only dive into the more complex way here.</p>
</div>
<div class="paragraph">
<p>You will do most of your RBAC configuration here.</p>
</div>
<div class="sect2">
<h3 id="1-what-do-you-need"><a class="anchor" href="#1-what-do-you-need"></a>1. What do you need?</h3>
<div class="paragraph">
<p>We recommend that you build a table similar to the example below that contains endpoints and the roles that you wish to allow access to those endpoints.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="4">Capability</th>
<th class="tableblock halign-center valign-top" colspan="3">Role</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Method name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Endpoint</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HTTP Method</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a:creator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a:observer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a:admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Create New Widget</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/a/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#160;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">List Widgets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/a/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#160;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Replace Widget</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/a/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Delete Widget</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/a/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#160;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#160;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="2-decide-on-the-right-filter-for-you"><a class="anchor" href="#2-decide-on-the-right-filter-for-you"></a>2. Decide on the right filter for you.</h3>
<div class="paragraph">
<p>From here you have to decide which filter you want to use.
There are two options and they both use the same underlying mechanism for enforcement.
The only real difference between them is the first option is simple and easy, while the second option has more features which require a little extra configuration.</p>
</div>
<div class="sect3">
<h4 id="1-simple-rbac-filter"><a class="anchor" href="#1-simple-rbac-filter"></a>1. Simple RBAC filter</h4>
<div class="paragraph">
<p>The Simple RBAC filter is configured using a Domain Specific Language (DSL) similar to the table above.</p>
</div>
<div class="listingblock">
<div class="title">simple-rbac.cfg.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#579">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span style="color:#070;font-weight:bold">&lt;simple-rbac</span> <span style="color:#b48">xmlns</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://docs.openrepose.org/repose/simple-rbac/v1.0</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;resources&gt;</span>
/path/to/this   GET     role1,role2,role3,role4
/path/to/this   PUT     role1,role2,role3
/path/to/this   POST    role1,role2
/path/to/this   DELETE  role1
/path/to/that   GET,PUT ALL
/path/to/that   ALL     role1
/path/{to}/wild GET     role1
    <span style="color:#070;font-weight:bold">&lt;/resources&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/simple-rbac&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The best part about this filter is that if your API grows or simply becomes to complex for the Simple RBAC filter, then you can easily move to the full API Validator filter later.
There is even a setting available to save your Simple RBAC filter configuration in a manner that you can use it immediately with the API Validator filter.</p>
</div>
<div class="paragraph">
<p>Please refer to the <a href="../filters/simple-rbac.html">Simple RBAC filter</a> documentation for more information about the available configuration options.</p>
</div>
</div>
<div class="sect3">
<h4 id="2-api-validator-filter"><a class="anchor" href="#2-api-validator-filter"></a>2. API Validator filter</h4>
<div class="paragraph">
<p>If your API is complex or you simply need or are already using some of the extra features available in the API Validator filter, then this is the choice for you.</p>
</div>
<div class="sect4">
<h5 id="1-enable-rax-roles"><a class="anchor" href="#1-enable-rax-roles"></a>1. Enable RAX-Roles</h5>
<div class="paragraph">
<p>When the <code>enable-rax-roles</code> attribute for the API Validator filter is set to true, the check-headers attribute will also be enabled regardless of your setting.</p>
</div>
<div class="listingblock">
<div class="title">validator.cfg.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#579">&lt;?xml version=&quot;1.1&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span style="color:#070;font-weight:bold">&lt;validators</span> <span style="color:#b48">multi-role-match</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">true</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">xmlns</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">http://openrepose.org/repose/validator/v1.0</span><span style="color:#710">'</span></span> <span style="color:#b48">version</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;validator</span> <span style="color:#b48">role</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">default</span><span style="color:#710">&quot;</span></span>
               <span style="color:#b48">default</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">true</span><span style="color:#710">&quot;</span></span>
               <span style="color:#b48">wadl</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file:///my/wadl/filewithraxroles.wadl</span><span style="color:#710">&quot;</span></span>
               <span style="color:#b48">dot-output</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/tmp/default.dot</span><span style="color:#710">&quot;</span></span>
               <span style="color:#b48">enable-rax-roles</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">true</span><span style="color:#710">&quot;</span></span>
    <span style="color:#070;font-weight:bold">/&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/validators&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="2-utilize-rax-roles"><a class="anchor" href="#2-utilize-rax-roles"></a>2. Utilize RAX-Roles</h5>
<div class="paragraph">
<p>In the WADL, include <code>rax:roles</code> with appropriate values to ensure access is controlled as expected.
When defining <code>rax:roles</code> at the resource level, be aware that all sub-resources and methods will inherit the roles allowed at the resource level.
Multiple roles can be specified by separating the role names with a space.
If multiple roles are authorized for a resource and method, the user must have one of the allowed roles but is not required to have all roles.
Example API Validator filter configuration for RBAC.
The following example shows a section of the API Validator filter and WADL that is configured for RBAC.</p>
</div>
<div class="listingblock">
<div class="title">api_with_roles.wadl</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;application</span> <span style="color:#b48">xmlns</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://wadl.dev.java.net/2009/02</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">xmlns:rax</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://docs.rackspace.com/api</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;resources</span> <span style="color:#b48">base</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">https://test.api.openstack.com</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;resource</span> <span style="color:#b48">path</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/a</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">rax:roles</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a:admin</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;method</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">POST</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">rax:roles</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a:creator</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;request&gt;</span>
                    <span style="color:#070;font-weight:bold">&lt;representation</span> <span style="color:#b48">mediaType</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">application/xml</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;/request&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;/method&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;method</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">GET</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">rax:roles</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a:observer</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;request&gt;</span>
                    <span style="color:#070;font-weight:bold">&lt;representation</span> <span style="color:#b48">mediaType</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">application/xml</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;/request&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;/method&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;method</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">PUT</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">rax:roles</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a:observer a:creator</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;request&gt;</span>
                    <span style="color:#070;font-weight:bold">&lt;representation</span> <span style="color:#b48">mediaType</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">application/xml</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;/request&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;/method&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;method</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">DELETE</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;request&gt;</span>
                    <span style="color:#070;font-weight:bold">&lt;representation</span> <span style="color:#b48">mediaType</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">application/xml</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;/request&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;/method&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/resource&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/resources&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/application&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above WADL and API Validator filter configuration, the following behavior will apply with a request with a user that has the <code>a:observer</code> role.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GET or PUT is allowed.</p>
</li>
<li>
<p>DELETE will return <strong>Forbidden</strong> (403) as the DELETE method inherits the <code>a:admin</code> role from its parent resource.</p>
</li>
<li>
<p>PATCH will return <strong>Method Not Allowed</strong> (405).</p>
</li>
<li>
<p>POST will return a <strong>Forbidden</strong> (403), as the method is allowed for the resource but the user does not have the <code>a:admin</code> or the <code>a:creator</code> role.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to the <a href="../filters/api-validator.html">API Validator filter</a> documentation for more information about the available configuration options.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 1. Return codes and conditions</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Description</th>
<th class="tableblock halign-center valign-top" colspan="2">Response Code</th>
<th class="tableblock halign-left valign-top" colspan="4">Returned When:</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Forbidden</p></td>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">403</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">A requested resource or method requires a specific X-Roles header and that header is not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Method Not Allowed</p></td>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">405</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">The URI is valid, but the method is not appropriate for the URI.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The status codes returned by authorization failures, via <code>rax:roles</code> extensions (403), differs from the statuses returned when roles are defined directly in the <code>validator.cfg.xml</code> (404 and 405).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="/_javascripts/page-loader.js" type="text/javascript"></script>
  <script src="/_javascripts/include-html.js" type="text/javascript"></script>
  <script>includeHTML();</script>
  <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>